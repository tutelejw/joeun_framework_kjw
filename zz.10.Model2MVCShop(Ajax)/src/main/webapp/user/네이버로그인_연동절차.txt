
Client ID	:  YhvYDqSntCxLVR1hLWdt
               YhvYDqSntCxLVR1hLWdt
Client Secret	  :  UfidBKEeEm
                     UfidBKEeEm


ì•ˆë…•í•˜ì„¸ìš”! ê¸°ì¡´ Spring MVC ë° MyBatis í”„ë¡œì íŠ¸ì— SDK ì—†ì´ ë„¤ì´ë²„ ë¡œê·¸ì¸ì„ ì—°ë™í•˜ëŠ” ë°©ë²•ì„ ë‹¨ê³„ë³„ë¡œ ìƒì„¸íˆ ì•ˆë‚´í•´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

ì œê³µí•´ì£¼ì‹  ì¹´ì¹´ì˜¤/êµ¬ê¸€ ë¡œê·¸ì¸ ì½”ë“œë¥¼ ì°¸ê³ í•˜ì—¬ ë„¤ì´ë²„ ë¡œê·¸ì¸ ê¸°ëŠ¥ë„ ë™ì¼í•œ íŒ¨í„´ìœ¼ë¡œ êµ¬í˜„í•˜ê² ìŠµë‹ˆë‹¤. íŒì—… ë°©ì‹ê³¼ ë™ì  Redirect URI ì²˜ë¦¬ ë“± ìš”ì²­í•˜ì‹  ëª¨ë“  ì‚¬í•­ì„ ë°˜ì˜í–ˆìŠµë‹ˆë‹¤.

ğŸ“¥ 1. ì‚¬ì „ ì¤€ë¹„ ì‚¬í•­
ë„¤ì´ë²„ ë¡œê·¸ì¸ì„ êµ¬í˜„í•˜ê¸° ì „ì— ëª‡ ê°€ì§€ ì¤€ë¹„ê°€ í•„ìš”í•©ë‹ˆë‹¤.

ë„¤ì´ë²„ ê°œë°œì ì„¼í„° ë“±ë¡
ë„¤ì´ë²„ ê°œë°œì ì„¼í„°ì— ì ‘ì†í•˜ì—¬ ë¡œê·¸ì¸í•©ë‹ˆë‹¤.
https://developers.naver.com/main/

Application > ì• í”Œë¦¬ì¼€ì´ì…˜ ë“±ë¡ ë©”ë‰´ë¡œ ì´ë™í•©ë‹ˆë‹¤.

ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ë¦„ì„ ì…ë ¥í•˜ê³ , ì‚¬ìš© APIì—ì„œ **ë„¤ì•„ë¡œ(ë„¤ì´ë²„ ì•„ì´ë””ë¡œ ë¡œê·¸ì¸)**ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.

ë¡œê·¸ì¸ ì˜¤í”ˆ API ì„œë¹„ìŠ¤ í™˜ê²½ì„ PC ì›¹ìœ¼ë¡œ ì„ íƒí•©ë‹ˆë‹¤.

ì„œë¹„ìŠ¤ URLê³¼ ë¡œê·¸ì¸ Callback URLì„ ë“±ë¡í•©ë‹ˆë‹¤.

ì„œë¹„ìŠ¤ URL: http://localhost:8080

Callback URL: http://localhost:8080/user/naverLogin

(ì¶”ê°€) http://127.0.0.1:8080 í™˜ê²½ì—ì„œë„ í…ŒìŠ¤íŠ¸í•˜ë ¤ë©´ ì„œë¹„ìŠ¤ URLê³¼ Callback URLì— 127.0.0.1 ë²„ì „ë„ ì¶”ê°€ë¡œ ë“±ë¡í•´ì£¼ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

ë“±ë¡ì´ ì™„ë£Œë˜ë©´ Client IDì™€ Client Secretì„ ë°œê¸‰ë°›ê²Œ ë©ë‹ˆë‹¤. ì´ ë‘ ê°’ì„ ì½”ë“œì—ì„œ ì‚¬ìš©í•˜ê²Œ ë˜ë‹ˆ ì˜ ë³´ê´€í•´ì£¼ì„¸ìš”.

**ë¼ì´ë¸ŒëŸ¬ë¦¬ ë‹¤ìš´ë¡œë“œ (
.jar íŒŒì¼)**

Mavenì„ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ, JSON ë°ì´í„°ë¥¼ Java ê°ì²´ë¡œ ë³€í™˜í•˜ê¸° ìœ„í•œ Jackson ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤. ì´ë¯¸ UserControllerì—ì„œ ObjectMapperë¥¼ ì‚¬ìš©í•˜ê³  ìˆìœ¼ë¯€ë¡œ, í•´ë‹¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ WEB-INF/lib í´ë”ì— ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”. ì—†ë‹¤ë©´ ì•„ë˜ íŒŒì¼ë“¤ì„ ë‹¤ìš´ë¡œë“œí•˜ì—¬ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.

Jackson Databind: jackson-databind-2.9.8.jar (ë˜ëŠ” ìµœì‹  ì•ˆì • ë²„ì „)

Jackson Core: jackson-core-2.9.8.jar

Jackson Annotations: jackson-annotations-2.9.8.jar

ğŸ‘‰ ë‹¤ìš´ë¡œë“œ ë§í¬: Maven Central Repository ì—ì„œ ê° ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ê²€ìƒ‰í•˜ì—¬ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

âœï¸ 2. JSP íŒŒì¼ ìˆ˜ì • ë° ì¶”ê°€
loginView.jsp ìˆ˜ì •
ê¸°ì¡´ loginView.jspì— ë„¤ì´ë²„ ë¡œê·¸ì¸ ë²„íŠ¼ê³¼ ê´€ë ¨ JavaScript í•¨ìˆ˜ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.

Java

<%@ page contentType="text/html; charset=UTF-8" %>
<%@ page pageEncoding="UTF-8" %>
<%-- ì„¸ì…˜ì— state í† í° ì €ì¥ì„ ìœ„í•´ import --%>
<%@ page import="java.math.BigInteger" %>
<%@ page import="java.security.SecureRandom" %>

<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ë¡œê·¸ì¸ í™”ë©´</title>
    <link rel="stylesheet" href="/css/admin.css" type="text/css">
    <script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>

    <script type="text/javascript">
        $(function() {
            // ê¸°ì¡´ ë¡œê·¸ì¸, íšŒì›ê°€ì… ë¡œì§ ... (ìƒëµ)

            // ============= ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ ë²„íŠ¼ Event ì—°ê²° =============
            $("#kakaoLoginBtn").on("click", function() {
                kakaoLoginPopup();
            });
            
            // ============= êµ¬ê¸€ ë¡œê·¸ì¸ ë²„íŠ¼ Event ì—°ê²° =============
            $("#googleLoginBtn").on("click", function() {
                googleLoginPopup();
            });

            // ============= [ì‹ ê·œ] ë„¤ì´ë²„ ë¡œê·¸ì¸ ë²„íŠ¼ Event ì—°ê²° =============
            $("#naverLoginBtn").on("click", function() {
                naverLoginPopup();
            });
        });

        // ============= íšŒì›ì›ê°€ì…í™”ë©´ì´ë™ =============
        // (ìƒëµ) ...

        // ============= ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸ íŒì—… ì²˜ë¦¬ í•¨ìˆ˜ =============
        // (ìƒëµ) ...
        
        // ============= êµ¬ê¸€ ë¡œê·¸ì¸ íŒì—… ì²˜ë¦¬ í•¨ìˆ˜ =============
        // (ìƒëµ) ...

        // ============= [ì‹ ê·œ] ë„¤ì´ë²„ ë¡œê·¸ì¸ íŒì—… ì²˜ë¦¬ í•¨ìˆ˜ =============
        function naverLoginPopup() {
            // 1. Naver Developer Centerì—ì„œ ë°œê¸‰ë°›ì€ Client ID
            const NAVER_CLIENT_ID = "YOUR_NAVER_CLIENT_ID"; // â—€â—€â—€ ì—¬ê¸°ì— ë°œê¸‰ë°›ì€ í´ë¼ì´ì–¸íŠ¸ IDë¥¼ ì…ë ¥í•˜ì„¸ìš”.

            // 2. ë™ì ìœ¼ë¡œ Redirect URI ìƒì„± (í˜„ì¬ ì ‘ì†í•œ í”„ë¡œí† ì½œ, í˜¸ìŠ¤íŠ¸, í¬íŠ¸ ê¸°ì¤€)
            const NAVER_REDIRECT_URI = window.location.origin + '/user/naverLogin';
            
            // 3. CSRF ë°©ì§€ë¥¼ ìœ„í•œ state ê°’ ìƒì„± (JSP ìƒë‹¨ì—ì„œ ìƒì„±í•œ ê°’ì„ ì‚¬ìš©)
            const state = "${state}"; // ì•„ë˜ body ë¶€ë¶„ì—ì„œ JSP ìŠ¤í¬ë¦½í‹€ë¦¿ìœ¼ë¡œ ìƒì„±í•œ ê°’ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.

            // 4. OAuth 2.0 ì¸ì¦ URL ìƒì„±
            const authUrl = "https://nid.naver.com/oauth2.0/authorize?response_type=code"
                        + "&client_id=" + NAVER_CLIENT_ID
                        + "&redirect_uri=" + encodeURIComponent(NAVER_REDIRECT_URI)
                        + "&state=" + state;

            // [ë””ë²„ê¹…] ìƒì„±ëœ ì¸ì¦ URLê³¼ Redirect URI, state ê°’ì„ ì½˜ì†”ì— ì¶œë ¥
            console.log("ë„¤ì´ë²„ ì¸ì¦ URL:", authUrl);
            console.log("ë™ì  Redirect URI:", NAVER_REDIRECT_URI);
            console.log("State ê°’:", state);

            // 5. íŒì—… ì°½ ì—´ê¸°
            window.open(authUrl, 'naverLoginPopup', 'width=600,height=700');
        }

        // ============= [ì‹ ê·œ] ë„¤ì´ë²„ ë¡œê·¸ì¸ íŒì—… ì½œë°± í•¨ìˆ˜ =============
        // ì´ í•¨ìˆ˜ëŠ” íŒì—…(naverCallback.jsp)ì—ì„œ ë¡œê·¸ì¸ì´ ì„±ê³µí–ˆì„ ë•Œ í˜¸ì¶œí•©ë‹ˆë‹¤.
        function naverLoginCallback(userId) {
            console.log("naverLoginCallback í˜¸ì¶œë¨! userId:", userId);
            // ë¶€ëª¨ì°½(index.jsp)ì˜ í”„ë ˆì„ë“¤ì„ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ë¡œê·¸ì¸ ìƒíƒœë¥¼ ë°˜ì˜
            $(window.parent.frames["topFrame"].document.location).attr("href","/layout/top.jsp");
            $(window.parent.frames["leftFrame"].document.location).attr("href","/layout/left.jsp");
            $(window.parent.frames["rightFrame"].document.location).attr("href","/user/getUser?userId="+userId);
        }

        // êµ¬ê¸€/ì¹´ì¹´ì˜¤ ì½œë°± í•¨ìˆ˜ (ìƒëµ) ...
    </script>
</head>

<body bgcolor="#ffffff" text="#000000">

<%
    // CSRF ê³µê²© ë°©ì§€ë¥¼ ìœ„í•œ state í† í° ìƒì„± ë° ì„¸ì…˜ì— ì €ì¥
    String state = new BigInteger(130, new SecureRandom()).toString();
    session.setAttribute("state", state);
%>

<form onsubmit="return false;">
    <div align="center">
        <TABLE WITH="100%" HEIGHT="100%" BORDER="0" CELLPADDING="0" CELLSPACING="0">
            <TR>
                <TD ALIGN="CENTER" VALIGN="MIDDLE">
                    <table width="650" height="390" border="5" cellpadding="0" cellspacing="0" bordercolor="#D6CDB7">
                        <tr>
                            <td width="10" height="5" align="left" valign="top" bordercolor="#D6CDB7">
                                <table width="650" height="390" border="0" cellpadding="0" cellspacing="0">
                                    <tr>
                                        <td width="345" align="left" valign="top">
                                            <table width="100%" height="220" border="0" cellpadding="0" cellspacing="0">
                                                <tr>
                                                    <td colspan="4" align="center" style="padding-top:10px;">
                                                        <img id="kakaoLoginBtn" src="/images/kakao_login_medium_narrow.jpg" style="cursor:pointer;"/>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td colspan="4" align="center" style="padding-top:5px;">
                                                        <img id="googleLoginBtn" src="/images/btn_google_signin_light_normal_web.png" style="cursor:pointer; height: 45px;"/>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td colspan="4" align="center" style="padding-top:5px;">
                                                        <img id="naverLoginBtn" src="/images/btnG_official.png" style="cursor:pointer; height: 45px;"/>
                                                        </td>
                                                    </tr>
                                            </table>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                    </table>
                </TD>
            </TR>
        </TABLE>
    </div>
</form>

</body>
</html>
/webapp/user/naverCallback.jsp íŒŒì¼ ì‹ ê·œ ìƒì„±
ë„¤ì´ë²„ ë¡œê·¸ì¸ ì„±ê³µ í›„, íŒì—… ì°½ì—ì„œ ë¶€ëª¨ ì°½ìœ¼ë¡œ ì •ë³´ë¥¼ ì „ë‹¬í•˜ê³  ìŠ¤ìŠ¤ë¡œ ë‹«íˆëŠ” ì—­í• ì„ í•  JSP íŒŒì¼ì„ ìƒˆë¡œ ë§Œë“­ë‹ˆë‹¤.

Java

<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ë„¤ì´ë²„ ë¡œê·¸ì¸ ì²˜ë¦¬</title>
<script type.text/javascript">
window.onload = function() {
    // Controllerì—ì„œ modelì— ë‹´ì•„ì¤€ ë¡œê·¸ì¸ ì„±ê³µ ì—¬ë¶€ì™€ ì‚¬ìš©ì IDë¥¼ í™•ì¸
    const loginSuccess = "${loginSuccess}";
    const userId = "${userId}";

    console.log("naverCallback.jsp ë¡œë“œë¨");
    console.log("ë¡œê·¸ì¸ ì„±ê³µ ì—¬ë¶€:", loginSuccess);
    console.log("ì‚¬ìš©ì ID:", userId);

    if (loginSuccess === "true" && userId) {
        // ë¶€ëª¨ ì°½(loginView.jsp)ì˜ ì½œë°± í•¨ìˆ˜(naverLoginCallback)ë¥¼ í˜¸ì¶œ
        // openerëŠ” íŒì—…ì„ ë„ìš´ ë¶€ëª¨ ì°½ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.
        if (window.opener && window.opener.naverLoginCallback) {
            console.log("ë¶€ëª¨ ì°½ì˜ naverLoginCallback í•¨ìˆ˜ í˜¸ì¶œ ì‹œë„");
            window.opener.naverLoginCallback(userId);
        } else {
            console.error("ë¶€ëª¨ ì°½ ë˜ëŠ” ì½œë°± í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            alert("ë¡œê·¸ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. (ë¶€ëª¨ ì°½ ì—†ìŒ)");
        }
    } else {
        // ë¡œê·¸ì¸ ì‹¤íŒ¨ ì‹œ
        const errorMessage = "${errorMessage}";
        console.error("ë„¤ì´ë²„ ë¡œê·¸ì¸ ì‹¤íŒ¨:", errorMessage);
        alert("ë„¤ì´ë²„ ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. " + errorMessage);
    }

    // ëª¨ë“  ì²˜ë¦¬ê°€ ëë‚˜ë©´ íŒì—… ì°½ì„ ë‹«ìŒ
    console.log("íŒì—… ì°½ì„ ë‹«ìŠµë‹ˆë‹¤.");
    window.close();
};
</script>
</head>
<body>
    ë¡œê·¸ì¸ ì²˜ë¦¬ ì¤‘...
</body>
</html>
â˜• 3. UserController.java ìˆ˜ì •
ë„¤ì´ë²„ ë¡œê·¸ì¸ ì½œë°±ì„ ì²˜ë¦¬í•  ë©”ì†Œë“œì™€ ê´€ë ¨ í—¬í¼ ë©”ì†Œë“œë“¤ì„ ì¶”ê°€í•©ë‹ˆë‹¤.

Java

// UserController.java

// ================== í•„ìš”í•œ import ë¬¸ ì¶”ê°€ ==================
// (ê¸°ì¡´ importë¬¸ì€ ìƒëµ)
import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.InputStreamReader;
import java.io.OutputStreamWriter;
import java.net.HttpURLConnection;
import java.net.URL;
import java.net.URLEncoder; // Redirect URI ì¸ì½”ë”©ì— ì‚¬ìš©
import java.util.Map;
import javax.servlet.http.HttpServletRequest; // ë™ì  Redirect URI ìƒì„±ì— í•„ìš”
import javax.servlet.http.HttpSession;
import com.fasterxml.jackson.core.type.TypeReference;
import com.fasterxml.jackson.databind.ObjectMapper;
// ... (ê¸°ì¡´ ë‹¤ë¥¸ importë¬¸)
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestMethod;
import org.springframework.web.bind.annotation.RequestParam;

@Controller
@RequestMapping("/user/*")
public class UserController {

    // (ê¸°ì¡´ ì½”ë“œ ìƒëµ) ...

    // ============= [ì‹ ê·œ] ë„¤ì´ë²„ ë¡œê·¸ì¸ ì½œë°± ì²˜ë¦¬ ë©”ì†Œë“œ ì¶”ê°€ =============
    @RequestMapping(value="naverLogin", method=RequestMethod.GET)
    public String naverLogin(@RequestParam("code") String code, 
                             @RequestParam("state") String state, 
                             HttpSession session,
                             HttpServletRequest request,
                             Model model) throws Exception {

        System.out.println("\n============== NAVER LOGIN START ==============");
        System.out.println("1. /user/naverLogin GET ìš”ì²­ ë°›ìŒ (Callback)");

        // [ë””ë²„ê¹…] ì „ë‹¬ë°›ì€ code, state ê°’ í™•ì¸
        System.out.println("   - Authorization Code: " + code);
        System.out.println("   - State: " + state);

        // [ë³´ì•ˆ] ì„¸ì…˜ì— ì €ì¥ëœ stateì™€ ì½œë°±ìœ¼ë¡œ ì „ë‹¬ë°›ì€ stateê°€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
        String sessionState = (String) session.getAttribute("state");
        System.out.println("   - Session State: " + sessionState);
        if (sessionState == null || !sessionState.equals(state)) {
            System.out.println("[ERROR] ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆê±°ë‚˜ ìœ íš¨í•˜ì§€ ì•Šì€ state ê°’ì…ë‹ˆë‹¤.");
            model.addAttribute("loginSuccess", false);
            model.addAttribute("errorMessage", "ì„¸ì…˜ ë¶ˆì¼ì¹˜ ì˜¤ë¥˜");
            return "forward:/user/naverCallback.jsp";
        }
        session.removeAttribute("state"); // ì‚¬ìš©í•œ state ê°’ì€ ì¦‰ì‹œ ì œê±°

        // 2. ì¸ê°€ ì½”ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ Access Token ìš”ì²­
        String accessToken = getNaverAccessToken(code, state, request);
        if (accessToken == null) {
            System.out.println("[ERROR] Access Token ë°›ê¸° ì‹¤íŒ¨");
            model.addAttribute("loginSuccess", false);
            model.addAttribute("errorMessage", "í† í° ë°œê¸‰ ì‹¤íŒ¨");
            return "forward:/user/naverCallback.jsp";
        }
        System.out.println("2. Access Token ë°›ê¸° ì„±ê³µ: " + accessToken);

        // 3. Access Tokenìœ¼ë¡œ ë„¤ì´ë²„ ì‚¬ìš©ì ì •ë³´ ìš”ì²­
        Map<String, Object> naverUserInfo = getNaverUserInfo(accessToken);
        if (naverUserInfo == null) {
            System.out.println("[ERROR] ë„¤ì´ë²„ ì‚¬ìš©ì ì •ë³´ ë°›ê¸° ì‹¤íŒ¨");
            model.addAttribute("loginSuccess", false);
            model.addAttribute("errorMessage", "ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨");
            return "forward:/user/naverCallback.jsp";
        }
        System.out.println("3. ë„¤ì´ë²„ ì‚¬ìš©ì ì •ë³´ ë°›ê¸° ì„±ê³µ: " + naverUserInfo);
        
        // 4. ë„¤ì´ë²„ ì‚¬ìš©ì ì •ë³´ ê¸°ë°˜ìœ¼ë¡œ íšŒì› ì •ë³´ í™•ì¸ ë° ì²˜ë¦¬
        Map<String, String> response = (Map<String, String>) naverUserInfo.get("response");
        String naverId = response.get("id");
        String email = response.get("email");
        String userName = response.get("name");
        String userId = "n_" + naverId; // ê¸°ì¡´ íšŒì› IDì™€ ì¶©ëŒ ë°©ì§€ë¥¼ ìœ„í•´ 'n_' ì ‘ë‘ì‚¬ ì¶”ê°€

        // [ë””ë²„ê¹…] ë„¤ì´ë²„ì—ì„œ ë°›ì€ ì‚¬ìš©ì ì •ë³´ ë¡œê·¸
        System.out.println("   - Naver Unique ID: " + naverId);
        System.out.println("   - Email: " + email);
        System.out.println("   - Name: " + userName);
        System.out.println("   - Generated System userId: " + userId);

        User user = userService.getUser(userId);

        // 5. ë¹„íšŒì›ì¼ ê²½ìš° ìë™ íšŒì›ê°€ì…
        if (user == null) {
            System.out.println("4. ë¹„íšŒì› í™•ì¸. ìë™ íšŒì›ê°€ì…ì„ ì‹œì‘í•©ë‹ˆë‹¤.");
            user = new User();
            user.setUserId(userId);
            user.setUserName(userName);
            user.setEmail(email);
            user.setPassword(naverId); // naverIdë¥¼ ì„ì‹œ ë¹„ë°€ë²ˆí˜¸ë¡œ ì €ì¥
            user.setRole("user"); 

            System.out.println("   - DB ì €ì¥ ì§ì „ User ê°ì²´: " + user);
            userService.addUser(user);
            System.out.println("5. ì‹ ê·œ íšŒì›ê°€ì… ì™„ë£Œ.");
        } else {
            System.out.println("4. ê¸°ì¡´ íšŒì› í™•ì¸: " + user.getUserId());
        }

        // 6. ì„¸ì…˜ì— ë¡œê·¸ì¸ ì •ë³´ ì €ì¥
        session.setAttribute("user", user);
        model.addAttribute("loginSuccess", true);
        model.addAttribute("userId", user.getUserId());

        System.out.println("6. ì„¸ì…˜ ì €ì¥ ì™„ë£Œ. User ID: " + user.getUserId());
        System.out.println("============== NAVER LOGIN END ==============\n");

        // 7. íŒì—…ì„ ì œì–´í•  JSPë¡œ í¬ì›Œë”©
        return "forward:/user/naverCallback.jsp";
    }

    /**
     * [ì‹ ê·œ] ì¸ê°€ ì½”ë“œë¡œ Access Tokenì„ ìš”ì²­í•˜ëŠ” í—¬í¼ ë©”ì†Œë“œ
     */
    private String getNaverAccessToken(String code, String state, HttpServletRequest request) throws Exception {
        // 1. ë„¤ì´ë²„ ê°œë°œì ì„¼í„°ì—ì„œ ë°œê¸‰ë°›ì€ ì •ë³´
        String clientId = "YOUR_NAVER_CLIENT_ID"; // â—€â—€â—€ ì—¬ê¸°ì— í´ë¼ì´ì–¸íŠ¸ ID ì…ë ¥
        String clientSecret = "YOUR_NAVER_CLIENT_SECRET"; // â—€â—€â—€ ì—¬ê¸°ì— í´ë¼ì´ì–¸íŠ¸ ì‹œí¬ë¦¿ ì…ë ¥

        // 2. ë™ì  Redirect URI ìƒì„±
        // ìš”ì²­ë°›ì€ URL("http://localhost:8080/user/naverLogin")ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©
        String redirectURI = request.getRequestURL().toString();
        
        // 3. í† í° ë°œê¸‰ ìš”ì²­ URL
        String tokenUrl = "https://nid.naver.com/oauth2.0/token";
        URL url = new URL(tokenUrl);
        HttpURLConnection conn = (HttpURLConnection) url.openConnection();
        conn.setRequestMethod("POST");
        conn.setDoOutput(true);

        // 4. POST ìš”ì²­ ë³¸ë¬¸ ì‘ì„±
        BufferedWriter bw = new BufferedWriter(new OutputStreamWriter(conn.getOutputStream()));
        StringBuilder sb = new StringBuilder();
        sb.append("grant_type=authorization_code");
        sb.append("&client_id=").append(clientId);
        sb.append("&client_secret=").append(clientSecret);
        sb.append("&redirect_uri=").append(URLEncoder.encode(redirectURI, "UTF-8"));
        sb.append("&code=").append(code);
        sb.append("&state=").append(state);
        bw.write(sb.toString());
        bw.flush();

        // [ë””ë²„ê¹…] í† í° ìš”ì²­ ì •ë³´ ë° ì‘ë‹µ ì½”ë“œ ì¶œë ¥
        System.out.println("\n   [getNaverAccessToken] >> Request URL: " + tokenUrl);
        System.out.println("   [getNaverAccessToken] >> Request Body: " + sb.toString());
        int responseCode = conn.getResponseCode();
        System.out.println("   [getNaverAccessToken] >> Response Code: " + responseCode);

        if (responseCode == 200) {
            BufferedReader br = new BufferedReader(new InputStreamReader(conn.getInputStream()));
            String line = "";
            StringBuilder result = new StringBuilder();
            while ((line = br.readLine()) != null) {
                result.append(line);
            }
            br.close();
            bw.close();

            // [ë””ë²„ê¹…] í† í° ì‘ë‹µ ê²°ê³¼ ì¶œë ¥
            System.out.println("   [getNaverAccessToken] >> Response Body: " + result.toString() + "\n");

            ObjectMapper objectMapper = new ObjectMapper();
            Map<String, Object> jsonMap = objectMapper.readValue(result.toString(), new TypeReference<Map<String, Object>>() {});
            return (String) jsonMap.get("access_token");
        }
        return null;
    }

    /**
     * [ì‹ ê·œ] Access Tokenìœ¼ë¡œ ì‚¬ìš©ì ì •ë³´ë¥¼ ìš”ì²­í•˜ëŠ” í—¬í¼ ë©”ì†Œë“œ
     */
    private Map<String, Object> getNaverUserInfo(String accessToken) throws Exception {
        String userInfoUrl = "https://openapi.naver.com/v1/nid/me";
        URL url = new URL(userInfoUrl);
        HttpURLConnection conn = (HttpURLConnection) url.openConnection();

        conn.setRequestMethod("GET");
        conn.setRequestProperty("Authorization", "Bearer " + accessToken);

        int responseCode = conn.getResponseCode();
        System.out.println("\n   [getNaverUserInfo] >> Request URL: " + userInfoUrl);
        System.out.println("   [getNaverUserInfo] >> Response Code: " + responseCode);

        if (responseCode == 200) {
            BufferedReader br = new BufferedReader(new InputStreamReader(conn.getInputStream()));
            String line = "";
            StringBuilder result = new StringBuilder();
            while ((line = br.readLine()) != null) {
                result.append(line);
            }
            br.close();

            // [ë””ë²„ê¹…] ì‚¬ìš©ì ì •ë³´ ì‘ë‹µ ì¶œë ¥
            System.out.println("   [getNaverUserInfo] >> Response Body: " + result.toString() + "\n");

            ObjectMapper objectMapper = new ObjectMapper();
            return objectMapper.readValue(result.toString(), new TypeReference<Map<String, Object>>() {});
        }
        return null;
    }
    
    // (ê¸°ì¡´ ë‹¤ë¥¸ ë©”ì†Œë“œë“¤ ìƒëµ) ...
}
âœ… ìµœì¢… í™•ì¸ ë° ì‹¤í–‰ ê°€ì´ë“œ
ë„¤ì´ë²„ ê³µì‹ ë¡œê·¸ì¸ ë²„íŠ¼ ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë¡œë“œí•˜ì—¬ /webapp/images/ í´ë”ì— btnG_official.png ì™€ ê°™ì€ ì´ë¦„ìœ¼ë¡œ ì €ì¥í•©ë‹ˆë‹¤.

loginView.jspì™€ UserController.java ì½”ë“œì— ìˆëŠ” YOUR_NAVER_CLIENT_IDì™€ YOUR_NAVER_CLIENT_SECRETì„ ë³¸ì¸ì´ ë°œê¸‰ë°›ì€ ê°’ìœ¼ë¡œ ë°˜ë“œì‹œ êµì²´í•©ë‹ˆë‹¤.

Jackson ë¼ì´ë¸ŒëŸ¬ë¦¬(.jar) íŒŒì¼ë“¤ì´ /webapp/WEB-INF/lib í´ë”ì— ìˆëŠ”ì§€ ë‹¤ì‹œ í•œë²ˆ í™•ì¸í•©ë‹ˆë‹¤.

Tomcat ì„œë²„ë¥¼ ì¬ì‹œì‘í•˜ê³  http://localhost:8080/user/loginView.jspë¡œ ì ‘ì†í•˜ì—¬ ë„¤ì´ë²„ ë¡œê·¸ì¸ ë²„íŠ¼ì´ ë³´ì´ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ íŒì—… ì°½ì´ ì •ìƒì ìœ¼ë¡œ ëœ¨ëŠ”ì§€, ë¡œê·¸ì¸ í›„ íŒì—…ì´ ë‹«íˆë©´ì„œ ì›ë˜ í˜ì´ì§€ì˜ ë¡œê·¸ì¸ì´ ì™„ë£Œë˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

Eclipse/STSì˜ Consoleì„ í†µí•´ System.out.printlnìœ¼ë¡œ ì¶”ê°€í•œ ë””ë²„ê¹… ë¡œê·¸ê°€ ìˆœì„œëŒ€ë¡œ ì¶œë ¥ë˜ëŠ”ì§€ í™•ì¸í•˜ì—¬ ë¬¸ì œ ë°œìƒ ì‹œ ì›ì¸ì„ íŒŒì•…í•©ë‹ˆë‹¤.

ì´ì œ ëª¨ë“  ì„¤ì •ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ìœ„ ê°€ì´ë“œë¥¼ ë”°ë¼ ì§„í–‰í•˜ì‹œë©´ ì„±ê³µì ìœ¼ë¡œ ë„¤ì´ë²„ ë¡œê·¸ì¸ ê¸°ëŠ¥ì„ ì—°ë™í•  ìˆ˜ ìˆì„ ê²ƒì…ë‹ˆë‹¤.
04.Model2MVCShop(Business Logic,MyBatis Spring)/src/main/java/com/model2/mvc/service/product/impl/3.ProductDaoImpl_ProductServiceImpl_PRD.txt

Spring + MyBatis ê¸°ë°˜ í”„ë¡œì íŠ¸ì—ì„œ DAO êµ¬í˜„ì²´ë¥¼ ì‘ì„±í•˜ë ¤ê³  í•´.
ì•„ë˜ ìë£Œë¥¼ ì°¸ê³ í•´ì„œ ProductDaoImpl.java ProductServiceImpl.javaíŒŒì¼ì„ ë§Œë“¤ì–´ì¤˜.

[ì°¸ê³  íŒŒì¼]
- ProductDao.java : Product ê´€ë ¨ DAO ì¸í„°í˜ì´ìŠ¤
- ProductService.java : Product ì„œë¹„ìŠ¤ ê³„ì¸µ ì¸í„°í˜ì´ìŠ¤
- ProductMapper.xml : Product í…Œì´ë¸”ì— ëŒ€í•œ MyBatis SQL ë§¤í¼(XML)

[ì‘ì„± ì¡°ê±´]
1. íŒ¨í‚¤ì§€ ê²½ë¡œëŠ” ë°˜ë“œì‹œ ë‹¤ìŒê³¼ ê°™ì´ í•´ì¤˜:
   package com.model2.mvc.service.product.impl;

2. í´ë˜ìŠ¤ëª…: ProductDaoImpl
   - ProductDao ì¸í„°í˜ì´ìŠ¤ë¥¼ implements í•´ì•¼ í•¨.

3. MyBatis SqlSession ì£¼ì…
   - Spring í™˜ê²½ì—ì„œ @Autowiredë¡œ SqlSession ì£¼ì…ë°›ê¸°
   - SqlSessionTemplate ë˜ëŠ” SqlSession ì‚¬ìš© ê°€ëŠ¥

4. ë©”ì„œë“œ ë™ì‘
   - add INSERT ì‹¤í–‰ í›„ ì˜í–¥ì„ ë°›ì€ í–‰ ìˆ˜(int) ë¦¬í„´
   - find SELECT ì‹¤í–‰ í›„ ê°ì²´ ë¦¬í„´
   - update UPDATE ì‹¤í–‰ í›„ ì˜í–¥ì„ ë°›ì€ í–‰ ìˆ˜ ë¦¬í„´
   - del DELETE ì‹¤í–‰ í›„ ì˜í–¥ì„ ë°›ì€ í–‰ ìˆ˜ ë¦¬í„´
   - List SELECT ì‹¤í–‰ í›„ List<ê°ì²´> ë¦¬í„´
   - getTotalCount(Search search) â†’ SELECT ì‹¤í–‰ í›„ int ë¦¬í„´

5. ë””ë²„ê¹… ëª©ì 
   - ìƒì„±ì í˜¸ì¶œ ì‹œ System.out.println("==> " + getClass() + " ìƒì„±ì í˜¸ì¶œ");
   - setter í˜¸ì¶œ ì‹œì—ë„ ë¡œê·¸ ì¶œë ¥
   - ê° ë©”ì„œë“œ ì‹¤í–‰ ì‹œ SQL ì‹¤í–‰ ê²°ê³¼(affected rows, ì¡°íšŒ ê²°ê³¼ ë“±) ì¶œë ¥

6. ëª¨ë“  ë©”ì„œë“œëŠ” `throws Exception` ì„ ì–¸ (êµìœ¡ìš©ìœ¼ë¡œ try-catch ìƒëµ)

7. ì½”ë“œ ìŠ¤íƒ€ì¼
   - @Repository("productDao") ì• ë…¸í…Œì´ì…˜ ë¶™ì´ê¸°
   - MyBatis ë§¤í¼ì˜ namespaceëŠ” "ProductMapper" ì‚¬ìš©
   - sqlSession.insert("ProductMapper.addProduct", product) í˜•ì‹ìœ¼ë¡œ í˜¸ì¶œ
   - INSERT, UPDATE, DELETEëŠ” ì‹¤í–‰ í›„ ë°˜í™˜ê°’ì„ ë³€ìˆ˜ì— ë‹´ì•„ ë¡œê·¸ ì¶œë ¥
   - SELECTëŠ” ê²°ê³¼ ê°ì²´/ë¦¬ìŠ¤íŠ¸ë¥¼ ë³€ìˆ˜ì— ë‹´ì•„ ë¡œê·¸ ì¶œë ¥
   
   
   
package com.model2.mvc.service.product;

import java.util.Map;
import com.model2.mvc.common.Search;
import com.model2.mvc.service.domain.Product;

public interface ProductDao {

    public void insertProduct(Product product) throws Exception;

    public Product findProduct(String prodNo) throws Exception;

    public int getTotalCount(Search search) throws Exception;

    public Map<String, Object> getProductList(Search search) throws Exception;

    public void updateProduct(Product product) throws Exception;
}




package com.model2.mvc.service.product;

import java.util.Map;
import com.model2.mvc.common.Search;
import com.model2.mvc.service.domain.Product;

public interface ProductService {
    
    public void addProduct(Product product) throws Exception;

    public Product getProduct(int prodNo) throws Exception;

    public Map<String, Object> getProductList(Search search) throws Exception;

    public void updateProduct(Product product) throws Exception;

    public int getTotalCount(Search search) throws Exception; // ğŸ‘ˆ ì¶”ê°€ ê°€ëŠ¥
}



<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.model2.mvc.service.product.ProductDao">

  <!-- ResultMap for Product -->
  <resultMap id="productResultMap" type="com.model2.mvc.service.domain.Product">
    <id property="prodNo" column="PROD_NO" jdbcType="INTEGER"/>
    <result property="prodName" column="PROD_NAME" jdbcType="VARCHAR"/>
    <result property="prodDetail" column="PROD_DETAIL" jdbcType="VARCHAR"/>
    <result property="manuDate" column="MANUFACTURE_DAY" jdbcType="VARCHAR"/>
    <result property="price" column="PRICE" jdbcType="INTEGER"/>
    <result property="fileName" column="IMAGE_FILE" jdbcType="VARCHAR"/>
    <result property="regDate" column="REG_DATE" jdbcType="DATE"/>
    <result property="proTranCode" column="TRAN_STATUS_TEXT" jdbcType="VARCHAR"/>
  </resultMap>

  <!-- Insert Product -->
  <insert id="insertProduct" parameterType="com.model2.mvc.service.domain.Product">
    INSERT INTO PRODUCT (
      PROD_NO, IMAGE_FILE, MANUFACTURE_DAY, PRICE, PROD_DETAIL, PROD_NAME, REG_DATE
    )
    VALUES (
      seq_product_prod_no.NEXTVAL,
      #{fileName, jdbcType=VARCHAR},
      #{manuDate, jdbcType=VARCHAR},
      #{price, jdbcType=INTEGER},
      #{prodDetail, jdbcType=VARCHAR},
      #{prodName, jdbcType=VARCHAR},
      SYSDATE
    )
  </insert>

  <!-- Find Product -->
  <select id="findProduct" parameterType="String" resultMap="productResultMap">
    SELECT
      P.PROD_NO, P.PROD_NAME, P.PROD_DETAIL, P.MANUFACTURE_DAY,
      P.PRICE, P.IMAGE_FILE, P.REG_DATE,
      CASE
        WHEN T.PROD_NO IS NOT NULL THEN 'ì¬ê³ ì—†ìŒ'
        ELSE 'íŒë§¤ì¤‘'
      END AS TRAN_STATUS_TEXT
    FROM PRODUCT P
    LEFT JOIN TRANSACTION T ON P.PROD_NO = T.PROD_NO
    WHERE P.PROD_NO = #{value, jdbcType=VARCHAR}
  </select>

  <!-- Get Total Count -->
  <select id="getTotalCount" parameterType="com.model2.mvc.common.Search" resultType="int">
    SELECT COUNT(*)
    FROM PRODUCT P
    LEFT JOIN TRANSACTION T ON P.PROD_NO = T.PROD_NO
    <where>
      <if test="searchCondition != null and searchKeyword != null and searchKeyword != ''">
        <choose>
          <when test="searchCondition == '0'">
            AND P.PROD_NO LIKE '%' || #{searchKeyword, jdbcType=VARCHAR} || '%'
          </when>
          <when test="searchCondition == '1'">
            AND P.PROD_NAME LIKE '%' || #{searchKeyword, jdbcType=VARCHAR} || '%'
          </when>
        </choose>
      </if>
    </where>
  </select>

  <!-- Get Product List (í˜ì´ì§• í¬í•¨) -->
  <select id="getProductList" parameterType="com.model2.mvc.common.Search" resultMap="productResultMap">
    SELECT * FROM (
      SELECT ROWNUM AS RNUM, A.* FROM (
        SELECT
          P.PROD_NO, P.PROD_NAME, P.PROD_DETAIL, P.MANUFACTURE_DAY,
          P.PRICE, P.IMAGE_FILE, P.REG_DATE,
          CASE
            WHEN T.PROD_NO IS NOT NULL THEN 'ì¬ê³ ì—†ìŒ'
            ELSE 'íŒë§¤ì¤‘'
          END AS TRAN_STATUS_TEXT
        FROM PRODUCT P
        LEFT JOIN TRANSACTION T ON P.PROD_NO = T.PROD_NO
        <where>
          <if test="searchCondition != null and searchKeyword != null and searchKeyword != ''">
            <choose>
              <when test="searchCondition == '0'">
                AND P.PROD_NO LIKE '%' || #{searchKeyword, jdbcType=VARCHAR} || '%'
              </when>
              <when test="searchCondition == '1'">
                AND P.PROD_NAME LIKE '%' || #{searchKeyword, jdbcType=VARCHAR} || '%'
              </when>
            </choose>
          </if>
        </where>
        ORDER BY P.PROD_NO DESC
      ) A
      WHERE ROWNUM &lt;= #{endRowNum, jdbcType=INTEGER}
    )
    WHERE RNUM &gt;= #{startRowNum, jdbcType=INTEGER}
  </select>

  <!-- Update Product -->
  <update id="updateProduct" parameterType="com.model2.mvc.service.domain.Product">
    UPDATE PRODUCT
    SET
      PROD_NAME = #{prodName, jdbcType=VARCHAR},
      PROD_DETAIL = #{prodDetail, jdbcType=VARCHAR},
      MANUFACTURE_DAY = #{manuDate, jdbcType=VARCHAR},
      PRICE = #{price, jdbcType=INTEGER},
      IMAGE_FILE = #{fileName, jdbcType=VARCHAR}
    WHERE PROD_NO = #{prodNo, jdbcType=INTEGER}
  </update>

</mapper>

04.Model2MVCShop(Business Logic,MyBatis Spring)/src/test/java/com/model2/mvc/service/purchase/test/PurchaseServiceTest_PRD.txt




ì£¼ì–´ì§„ í…ŒìŠ¤íŠ¸ ìë°” íŒŒì¼(PurchaseServiceTest.java)ì€ Spring Frameworkì™€ JUnit4ë¥¼ ì´ìš©í•˜ì—¬ PurchaseService í´ë˜ìŠ¤ì˜ ê¸°ëŠ¥(ì‚¬ìš©ì ì¶”ê°€, ì¡°íšŒ, ìˆ˜ì •, ì¤‘ë³µ í™•ì¸, ëª©ë¡ ì¡°íšŒ ë“±)ì„ í…ŒìŠ¤íŠ¸í•˜ëŠ” í†µí•© í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ì…ë‹ˆë‹¤.

ì´ì™€ ê°™ì€ í…ŒìŠ¤íŠ¸ íŒŒì¼ì„ ìƒì„±í•˜ê¸° ìœ„í•œ í”„ë¡¬í”„íŠ¸ë¥¼ ë§Œë“¤ê¸° ìœ„í•´ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ìš”ì†Œë“¤ì´ í•„ìš”í•©ë‹ˆë‹¤:

âœ… ëª©ì 

PurchaseServiceì˜ ì£¼ìš” ë©”ì„œë“œì— ëŒ€í•œ í†µí•© í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•œë‹¤.
(Spring + JUnit4 ê¸°ë°˜, í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ë³„ ë©”ì„œë“œ)

âœ… ì „ì œ ì¡°ê±´

Spring Framework ì‚¬ìš© ì¤‘

PurchaseService ì¸í„°í˜ì´ìŠ¤ì™€ êµ¬í˜„ì²´(purchaseServiceImpl)ê°€ ì¡´ì¬

ë„ë©”ì¸ í´ë˜ìŠ¤ Purchaseì™€ ê²€ìƒ‰ ì¡°ê±´ í´ë˜ìŠ¤ Search ì¡´ì¬

XML ê¸°ë°˜ ì„¤ì •(commonservice.xml)ìœ¼ë¡œ ë¹ˆ ì„¤ì •ë¨

ğŸ¯ í”„ë¡¬í”„íŠ¸ ì˜ˆì‹œ
Spring Frameworkì™€ JUnit4ë¥¼ ì‚¬ìš©í•´ `PurchaseService` í´ë˜ìŠ¤ì˜ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•˜ëŠ” í†µí•© í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ì–´ì¤˜.

### ì „ì œ
- `PurchaseService` ì¸í„°í˜ì´ìŠ¤ëŠ” ë‹¤ìŒ ê¸°ëŠ¥ì„ ê°€ì§„ë‹¤:
  1. `void addPurchase(Purchase purchase)`
  2. `Purchase getPurchase(int prodNo)`
  3. `void updatePurchase(Purchase purchase)`
  5. `Map<String, Object> getPurchaseList(Search search)`
  

### ì¡°ê±´
- `@RunWith(SpringJUnit4ClassRunner.class)`ì™€ `@ContextConfiguration`ìœ¼ë¡œ Spring ì„¤ì • íŒŒì¼ì„ ë¡œë”©
- `purchaseServiceImpl` ë¹ˆì„ ì£¼ì…ë°›ì•„ í…ŒìŠ¤íŠ¸
- í…ŒìŠ¤íŠ¸ ë©”ì„œë“œëŠ” `@Test`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì‘ì„±
- `Assert` í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•´ ê° ë©”ì„œë“œì˜ ì˜ˆìƒ ê²°ê³¼ë¥¼ ê²€ì¦
- ì˜ˆì™¸ ì²˜ë¦¬ë¥¼ ìœ„í•´ í…ŒìŠ¤íŠ¸ ë©”ì„œë“œëŠ” `throws Exception` ì‚¬ìš©
- ì½˜ì†” ì¶œë ¥ì€ ì£¼ì„ìœ¼ë¡œ ë‚¨ê²¨ì„œ ì„ íƒì ìœ¼ë¡œ í™•ì¸í•  ìˆ˜ ìˆê²Œ í•¨

### í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ í¬í•¨
1. addPurchase: ì‚¬ìš©ì ì¶”ê°€ í›„ getPurchaseë¡œ ê²€ì¦
2. getPurchase: ì¡´ì¬í•˜ëŠ” ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ
3. updatePurchase: ì‚¬ìš©ì ì •ë³´ ë³€ê²½ í›„ ê²€ì¦
5. getPurchaseList: ì „ì²´ ëª©ë¡ ì¡°íšŒ, ì¡°ê±´ë³„ ì¡°íšŒ (prodNo, purchaseName)

ì´ ì¡°ê±´ì„ PurchaseService ë°”íƒ•ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ í´ë˜ìŠ¤ `PurchaseServiceTest.java`ë¥¼ ìƒì„±í•´ì¤˜.ë‹¨, XML ì„¤ì • ê¸°ë°˜ìœ¼ë¡œ Beanì„ ì£¼ì…ë°›ê²Œ í•´ì¤˜







package com.model2.mvc.service.purchase;

import java.util.Map;

import com.model2.mvc.service.domain.Purchase;
import com.model2.mvc.common.Search;

public interface PurchaseService {

    public void addPurchase(Purchase purchase) throws Exception;

    public Purchase getPurchase(int tranNo) throws Exception;

    public Map<String, Object> getPurchaseList(Search search) throws Exception;

    public void updatePurchase(Purchase purchase) throws Exception;

    public void updateTranStatus(int prodNo, int tranCode) throws Exception;
}




package com.model2.mvc.service.purchase;

import java.util.List;
import java.util.Map;

import com.model2.mvc.service.domain.Purchase;
import com.model2.mvc.common.Search;

public interface PurchaseDao {

    public void insertPurchase(Purchase purchase) throws Exception;

    public Purchase findPurchase(int tranNo) throws Exception;

    public List<Purchase> getPurchaseList(Search search) throws Exception;

    public int getTotalCount(Search search) throws Exception;

    public void updatePurchase(Purchase purchase) throws Exception;

    public void updatePurchaseDelivery(int prodNo, int tranCode) throws Exception;
}




<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="PurchaseMapper">

    <!-- Result Map -->
<resultMap id="purchaseResultMap" type="com.model2.mvc.service.domain.Purchase">
    <id property="tranNo" column="tran_no" />
    <result property="paymentOption" column="payment_option" />
    <result property="receiverName" column="receiver_name" />
    <result property="receiverPhone" column="receiver_phone" />
    <result property="divyAddr" column="demailaddr" />
    <result property="divyRequest" column="dlvy_request" />
    <result property="tranCode" column="tran_status_code" />
    <result property="orderDate" column="order_date" jdbcType="DATE" />
    <result property="divyDate" column="dlvy_date" jdbcType="DATE" />

    <association property="purchaseProd" javaType="com.model2.mvc.service.domain.Product">
        <result property="prodNo" column="prod_no" />
    </association>

    <association property="buyer" javaType="com.model2.mvc.service.domain.User">
        <result property="userId" column="buyer_id" />
        <result property="userName" column="user_name" />
    </association>
</resultMap>


    <!-- Insert Purchase -->
    <insert id="insertPurchase" parameterType="com.model2.mvc.service.domain.Purchase">
        INSERT INTO transaction (
            tran_no, prod_no, buyer_id, payment_option,
            receiver_name, receiver_phone, demailaddr,
            dlvy_request, tran_status_code, order_date, dlvy_date
        ) VALUES (
            seq_transaction_tran_no.NEXTVAL,
            #{purchaseProd.prodNo, jdbcType=NUMERIC},
            #{buyer.userId, jdbcType=VARCHAR},
            #{paymentOption, jdbcType=CHAR},
            #{receiverName, jdbcType=VARCHAR},
            #{receiverPhone, jdbcType=VARCHAR},
            #{divyAddr, jdbcType=VARCHAR},
            #{divyRequest, jdbcType=VARCHAR},
            #{tranCode, jdbcType=CHAR},
            #{orderDate, jdbcType=DATE},
            #{divyDate, jdbcType=DATE}
        )
    </insert>

    <!-- Find Purchase -->
    <select id="findPurchase" parameterType="int" resultMap="purchaseResultMap">
        SELECT 
            T.tran_no, T.prod_no, T.buyer_id,
            U.user_name, T.payment_option, T.receiver_name,
            T.receiver_phone, T.demailaddr, T.dlvy_request,
            T.tran_status_code, T.order_date, T.dlvy_date
        FROM transaction T
        JOIN users U ON T.buyer_id = U.user_id
        WHERE T.tran_no = #{value, jdbcType=NUMERIC}
    </select>

    <!-- Get Purchase List with Paging & Search -->
    <select id="getPurchaseList" parameterType="com.model2.mvc.common.Search" resultMap="purchaseResultMap">
        SELECT * FROM (
            SELECT ROWNUM AS row_seq, A.* FROM (
                SELECT 
                    T.tran_no, T.prod_no, T.buyer_id,
                    U.user_name, T.payment_option, T.receiver_name,
                    T.receiver_phone, T.demailaddr, T.dlvy_request,
                    T.tran_status_code, T.order_date, T.dlvy_date
                FROM transaction T
                JOIN users U ON T.buyer_id = U.user_id
                <where>
                    <if test="searchCondition == '0' and searchKeyword != null and searchKeyword != ''">
                        T.buyer_id LIKE '%' || #{searchKeyword, jdbcType=VARCHAR} || '%'
                    </if>
                    <if test="searchCondition == '1' and searchKeyword != null and searchKeyword != ''">
                        T.receiver_name LIKE '%' || #{searchKeyword, jdbcType=VARCHAR} || '%'
                    </if>
                </where>
                ORDER BY T.tran_no DESC
            ) A
            WHERE ROWNUM &lt;= #{endRowNum, jdbcType=NUMERIC}
        )
        WHERE row_seq &gt;= #{startRowNum, jdbcType=NUMERIC}
    </select>

    <!-- Get Total Count -->
    <select id="getTotalCount" parameterType="com.model2.mvc.common.Search" resultType="int">
        SELECT COUNT(*) FROM (
            SELECT T.tran_no
            FROM transaction T
            JOIN users U ON T.buyer_id = U.user_id
            <where>
                <if test="searchCondition == '0' and searchKeyword != null and searchKeyword != ''">
                    T.buyer_id LIKE '%' || #{searchKeyword, jdbcType=VARCHAR} || '%'
                </if>
                <if test="searchCondition == '1' and searchKeyword != null and searchKeyword != ''">
                    T.receiver_name LIKE '%' || #{searchKeyword, jdbcType=VARCHAR} || '%'
                </if>
            </where>
        )
    </select>

    <!-- Update Purchase Info -->
    <update id="updatePurchase" parameterType="com.model2.mvc.service.domain.Purchase">
        UPDATE transaction
        SET
            receiver_name = #{receiverName, jdbcType=VARCHAR},
            receiver_phone = #{receiverPhone, jdbcType=VARCHAR},
            demailaddr = #{divyAddr, jdbcType=VARCHAR},
            dlvy_request = #{divyRequest, jdbcType=VARCHAR},
            dlvy_date = #{divyDate, jdbcType=DATE}
        WHERE tran_no = #{tranNo, jdbcType=NUMERIC}
    </update>

    <!-- Update Delivery Status -->
    <update id="updatePurchaseDelivery">
        UPDATE transaction
        SET tran_status_code = #{tranCode, jdbcType=CHAR}
        WHERE prod_no = #{prodNo, jdbcType=NUMERIC}
    </update>

</mapper>

